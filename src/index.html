<!-- Code from d3-graph-gallery.com -->
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <!-- Google fonts -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300" rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/css?family=Oswald:400,300,700" rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="styleCord.css">

    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://unpkg.com/d3-simple-slider"></script>
    <script>
        d3v6 = d3
        window.d3 = null
    </script>
    <script src="https://d3js.org/d3.v4.min.js"></script>

</head>

<body>
    <!-- Create a div where the graph will take place -->

    <div id="lineplotNotas"></div>

    <div id="lineplotOpcoes"></div>

    <h2>Range</h2>
    <div class="row align-items-center">
        <div class="col-sm-2">
            <p id="value-range"></p>
        </div>
        <div class="col-sm">
            <div id="slider-range"></div>
        </div>
    </div>
    <div id="grouped_bar_plot"></div>

    <div>
        <div id="radar_chart"></div>
        <input name="updateButton" type="button" value="See Evolution" id="viewAnimation" />
    </div>

    <h2>Year</h2>
    <div id="slider_container">
        <input type="range" id="slider" />
        <p id="label"> </p>
    </div>
    <br>
    <h2>Options</h2>
    <label for="option">Choose an option:</label>
    <select id="option">
        <option value="0">All Options</option>
        <optgroup label="Options">
            <option value="1">Option 1</option>
            <option value="2">Option 2</option>
            <option value="3">Option 3</option>
            <option value="4">Option 4</option>
            <option value="5">Option 5</option>
            <option value="6">Option 6</option>
        </optgroup>
    </select>
    <div id="cord_diagram"></div>

    <!-- Create a div for the tooltip -->
    <div id="tooltip"></div>


    <!-- Color Scale -->
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

    <script type="module">

        document.getElementById("viewAnimation").onclick = function () {
            const delayLoop = (fn, delay) => {
                return (x, i) => {
                    setTimeout(() => {
                        fn(x);
                    }, i * delay);
                };
            };
            let rangeYears = [2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016]
            let interval = 2000;
            var promise = Promise.resolve();
            rangeYears.forEach(delayLoop(updateData, 3000));
        };

        // Range
        var data = [2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016];
        var sliderRange = d3v6
            .sliderBottom()
            .min(d3v6.min(data))
            .max(d3v6.max(data))
            .step(1)
            .width(300)
            .ticks(6)
            .default([data[0],data[data.length-1]])
            .fill('#2196f3')
            .on('onchange', val => {
                d3v6.select('p#value-range').text(val.map(d3v6.format('')));
                let rangeVal = d3v6.select('p#value-range')._groups[0][0].innerHTML.split(",")
                call_BarPlot(rangeVal[0], rangeVal[1])
            });

        var gRange = d3v6
            .select('div#slider-range')
            .append('svg')
            .attr('width', 500)
            .attr('height', 100)
            .append('g')
            .attr('transform', 'translate(30,30)');

        gRange.call(sliderRange);

        d3v6.select('p#value-range').text(
            sliderRange
                .value()
                .map(d3v6.format(''))
                .join('-')
        );

        import Data from './Data.js';
        import LinePlot from './linePlot.js';
        import GroupedBarPlot from './groupedBarPlot.js';
        import RadarChart from './radarChart.js';
        import CordDiagram from './cordDiagram.js';
        import Plot from './plot.js';
        var data = new Data();

        var lineplotNotas = new LinePlot('#lineplotNotas');
        data.notas_ultimos_colocados('./files_list.csv', 2007, 2016, lineplotNotas.create_plot);

        var lineplotOpcoes = new LinePlot('#lineplotOpcoes');
        data.percentagem_posicao_curso('./files_list.csv', 'UA-EET', 2007, 2016, lineplotOpcoes.create_plot);

        var gbarplot = new GroupedBarPlot('#grouped_bar_plot');
        var radarChart = new RadarChart('#radar_chart');
        var cordDiagram = new CordDiagram('#cord_diagram');
            
        data.notas_colocados('./files_list.csv', 'UA-EET', 2007, 2016, gbarplot);

        let call_BarPlot = (min, max) => {
            data.notas_colocados('./files_list.csv', 'UA-EET', min, max, gbarplot);
        }

        let test = [
            { group: "banana", Nitrogen: "12", normal: "1", stress: "13" },
            { group: "poacee", Nitrogen: "6", normal: "6", stress: "33" },
            { group: "sorgho", Nitrogen: "11", normal: "28", stress: "12" },
            { group: "triticum", Nitrogen: "19", normal: "6", stress: "1" }
        ]
        test.columns = ["group", "Nitrogen", "normal", "stress"]

        var dataaa = [
            {
                name: 'Allocated_budget',
                axes: [
                    { axis: 'Sales', value: 42 },
                    { axis: 'Marketing', value: 20 },
                    { axis: 'Development', value: 60 },
                    { axis: 'Customer Support', value: 26 },
                    { axis: 'Information Technology', value: 35 },
                    { axis: 'Administration', value: 20 }
                ]
            },
            {
                name: 'Actual_Spending',
                axes: [
                    { axis: 'Sales', value: 50 },
                    { axis: 'Marketing', value: 45 },
                    { axis: 'Development', value: 20 },
                    { axis: 'Customer Support', value: 20 },
                    { axis: 'Information Technology', value: 25 },
                    { axis: 'Administration', value: 23 }
                ]
            }
        ];

        var radarChartOptions = {
            w: 490,
            h: 550,
            levels: 5,
            roundStrokes: true,
            color: d3.scaleOrdinal().range(["#AFC52F", "#ff6600", "#3258a8", "#db2121", "#fffb26", "#5c350b", "#c10ec4", "#0ec4af"]),
            format: '.0f',
            legend: { title: 'Cursos', translateX: -35, translateY: -300 },
            unit: ''
        };

        /*//////////////////////////////////////////////////////////
        ////////////////// Set up the Data /////////////////////////
        //////////////////////////////////////////////////////////*/

        var NameProvider = ["Apple", "HTC", "Huawei", "LG", "Nokia", "Samsung", "Sony", "Other"];

        var matrix = [
            [9.6899, 0.8859, 0.0554, 0.443, 2.5471, 2.4363, 0.5537, 2.5471], /*Apple 19.1584*/
            [0.1107, 1.8272, 0, 0.4983, 1.1074, 1.052, 0.2215, 0.4983], /*HTC 5.3154*/
            [0.0554, 0.2769, 0.2215, 0.2215, 0.3876, 0.8306, 0.0554, 0.3322], /*Huawei 2.3811*/
            [0.0554, 0.1107, 0.0554, 1.2182, 1.1628, 0.6645, 0.4983, 1.052], /*LG 4.8173*/
            [0.2215, 0.443, 0, 0.2769, 10.4097, 1.2182, 0.4983, 2.8239], /*Nokia 15.8915*/
            [1.1628, 2.6024, 0, 1.3843, 8.7486, 16.8328, 1.7165, 5.5925], /*Samsung 38.0399*/
            [0.0554, 0.4983, 0, 0.3322, 0.443, 0.8859, 1.7719, 0.443], /*Sony 4.4297*/
            [0.2215, 0.7198, 0, 0.3322, 1.6611, 1.495, 0.1107, 5.4264] /*Other 9.9667*/
        ];
        /*Sums up to exactly 100*/

        var colors = ["#C4C4C4", "#69B40F", "#EC1D25", "#C8125C", "#008FC8", "#10218B", "#134B24", "#737373"];

        //gbarplot.create_plot_csv("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/data_stacked.csv",['group'])
        //gbarplot.create_plot(test,["group"])
        //radarChart.create_plot(dataaa, radarChartOptions)

        var plot = new Plot('#slider', '#label', '#option');

        //plot.plot_alternativas_candidatos('./files_list.csv', data, radarChart, radarChartOptions)

        data.get_range_years('./files_list.csv', data, cordDiagram, colors, plot);

        data.preferencias_opcoes('./files_list.csv', 2016, radarChart, radarChartOptions)

        //cordDiagram.create_plot(matrix, NameProvider, colors)

        // ** Update data section (Called from the onclick)
        function updateData(element) {
            radarChart.clean_plot();
            setTimeout(function () {
                data.preferencias_opcoes('./files_list.csv', element, radarChart, radarChartOptions);
            }, 250)
            // Get the data again
        }
    </script>

</body>

</html>